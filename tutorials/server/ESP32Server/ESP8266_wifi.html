<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ESP8266 Setup â€“ SoifGo</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/themes/prism-tomorrow.min.css" rel="stylesheet" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/prism.min.js"></script>
<!-- Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§ÛŒ Ø²Ø¨Ø§Ù† -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-clike.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-c.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-cpp.min.js"></script>


<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/plugins/line-numbers/prism-line-numbers.min.js"></script>


<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/plugins/toolbar/prism-toolbar.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/plugins/toolbar/prism-toolbar.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>


  <style>
    body {
      font-family: sans-serif;
      background-color: #f9f9f9;
      padding: 1em;
      margin: auto;
      max-width: 100%;
      line-height: 1.6;
    }
    h1 {
      color: #0055aa;
      text-align: center;
      font-size: 2em;
    }
    h2 {
      color: #0055aa;
      margin-top: 2em;
      font-size: 1.5em;
    }
    p { margin-bottom: 1em; }
    a { color: #0077cc; text-decoration: none; }
    a:hover { text-decoration: underline; }
    img {
      max-width: 100%;
      height: auto;
      margin: 1em 0;
      border-radius: 6px;
    }
    pre {
    border-radius:8px;
    max-height:300px;
    overflow:auto;
    }
    code {
      background-color: #eee;
      padding: 2px 6px;
      border-radius: 4px;
    }
    video {
      max-width: 100%;
      border-radius: 6px;
      margin: 1em 0;
    }

    .btn {
      display: inline-block;
      padding: 10px 20px;
      border-radius: 5px;
      color: #fff;
      text-decoration: none;
      margin: 5px;
    }


    .btn-blue { background: #0066cc; }
    .btn-brown { background: #8B4513; }

    @media (max-width: 600px) {
      body { font-size: 18px; line-height: 1.8; }
      h1 { font-size: 24px; }
      h2 { font-size: 20px; }
      pre { font-size: 18px; line-height: 1.8; white-space: pre-wrap; word-wrap: break-word; }
    }
  </style>
</head>
<body>

  <h1>ðŸš€ ESP8266 Setup with SoifGo</h1>


  <h2>Step 1: Introduction</h2>
  <p>This tutorial helps you set up the ESP8266 Wi-Fi module and connect it to SoifGo.</p>

  <h2>Step 2: Preparing the Module</h2>
  <p>Use a USB to TTL converter. It can be a single USB-to-TTL board or a combination of USB-to-UART and UART-to-TTL.</p>
  <p>Youâ€™ll need both 5V and 3.3V power sources. Recommended converter:</p>
  <img src="converter.png" alt="Recommended Converter">

  <h2>Step 3: Arduino IDE Setup</h2>
  <p>Install the required libraries and check the port and board settings:</p>
  <img src="arduino1.png" alt="Library Install">
  <img src="arduino2.png" alt="Port Check">
  <img src="arduino3.png" alt="Board Selection">
   <img src="arduino4.png" alt="Board Selection">

  <h2>Step 4: Uploading the Program</h2>

<pre class="line-numbers"><code class="language-cpp">

#include <ESP8266WiFi.h>
#include <ESP8266WebServer.h>
#include <ArduinoJson.h>
#include <EEPROM.h>

#define EEPROM_SIZE 128

String wifiName;
String wifiPass;
int portLastByte;
String userPath;

IPAddress gateway(192, 168, 1, 1);
IPAddress subnet(255, 255, 255, 0);
IPAddress ip;

ESP8266WebServer server(80);
StaticJsonDocument<2048> dataStore;

unsigned long lastCheckTime = 0;

void saveStringToEEPROM(int start, const String& str) {
  for (int i = 0; i < str.length(); i++) {
    EEPROM.write(start + i, str[i]);
    yield();
  }
  EEPROM.write(start + str.length(), '\0');
}

String readStringFromEEPROM(int start) {
  char data[32];
  int i = 0;
  while (i < 31) {
    char c = EEPROM.read(start + i);
    if (c == '\0') break;
    data[i++] = c;
    yield();
  }
  data[i] = '\0';
  return String(data);
}

void saveSettings() {
  saveStringToEEPROM(0, wifiName);
  saveStringToEEPROM(32, wifiPass);
  EEPROM.write(64, portLastByte);
  saveStringToEEPROM(65, userPath);
  EEPROM.write(127, 1);
  EEPROM.commit();
}

void loadSettings() {
  bool isInitialized = EEPROM.read(127) == 1;

  if (isInitialized) {
    wifiName = readStringFromEEPROM(0);
    wifiPass = readStringFromEEPROM(32);
    portLastByte = EEPROM.read(64);
    userPath = readStringFromEEPROM(65);
  } else {
    wifiName = "TPLINK";
    wifiPass = "abcd1234";
    portLastByte = 104;
    userPath = "report";
    saveSettings();
  }

  if (wifiName.length() == 0) wifiName = "TPLINK";
  if (wifiPass.length() == 0) wifiPass = "abcd1234";
  if (portLastByte == 0 || portLastByte > 254) portLastByte = 104;
  if (userPath.length() == 0) userPath = "report";
}

void setup() {
  Serial.begin(115200);
  EEPROM.begin(EEPROM_SIZE);
  loadSettings();

  ip = IPAddress(192, 168, 1, portLastByte);
  WiFi.config(ip, gateway, subnet);
  WiFi.begin(wifiName.c_str(), wifiPass.c_str());

  Serial.println("Connecting to WiFi...");
  unsigned long startAttemptTime = millis();
  while (WiFi.status() != WL_CONNECTED && millis() - startAttemptTime < 10000) {
    delay(500);
    Serial.print(".");
    yield();
  }

  if (WiFi.status() == WL_CONNECTED) {
    Serial.println("\nConnected to WiFi");
    Serial.print("IP Address: ");
    Serial.println(WiFi.localIP());
    Serial.print("MAC Address: ");
    Serial.println(WiFi.macAddress());
  } else {
    Serial.println("\nFailed to connect to WiFi.");
  }

  server.on("/", HTTP_GET, []() {
    server.send(200, "application/json", "{\"message\":\"ESP8266 dynamic key server active\"}");
  });

  server.on("/keys", HTTP_GET, []() {
    JsonArray keys = dataStore.createNestedArray("_keys");
    for (JsonPair kv : dataStore.as<JsonObject>()) {
      if (String(kv.key().c_str()) != "_keys") {
        keys.add(kv.key());
      }
    }
    String response;
    serializeJson(keys, response);
    server.send(200, "application/json", response);
  });

  server.on("/" + userPath, HTTP_GET, []() {
    if (dataStore.containsKey("/" + userPath)) {
      String response;
      serializeJson(dataStore["/" + userPath], response);
      server.send(200, "application/json", response);
    } else {
      server.send(404, "application/json", "{\"status\":\"error\", \"message\":\"No data yet\"}");
    }
  });

  server.on("/" + userPath, HTTP_POST, []() {
    if (server.hasArg("plain")) {
      String body = server.arg("plain");
      StaticJsonDocument<512> incoming;
      DeserializationError error = deserializeJson(incoming, body);
      if (error) {
        server.send(400, "application/json", "{\"status\":\"error\", \"message\":\"Invalid JSON\"}");
        return;
      }

      JsonObject stored;
      if (dataStore["/" + userPath].is<JsonObject>()) {
        stored = dataStore["/" + userPath].as<JsonObject>();
      } else {
        stored = dataStore.createNestedObject("/" + userPath);
      }

      for (JsonPair kv : incoming.as<JsonObject>()) {
        stored[kv.key()] = kv.value();
        if (WiFi.status() == WL_CONNECTED) {
          Serial.println(" " + String(kv.key().c_str()) + ":" + String(kv.value().as<String>()));
        }
        yield();
      }

      String response;
      serializeJson(stored, response);
      server.send(200, "application/json", response);
    } else {
      server.send(400, "application/json", "{\"status\":\"error\", \"message\":\"No data received\"}");
    }
  });

  server.begin();
}

void loop() {
  server.handleClient();
  checkWiFiConnection();
  handleSerialFromMicro();
  yield();
}

void checkWiFiConnection() {
  unsigned long currentTime = millis();
  if (currentTime - lastCheckTime >= 10000) {
    lastCheckTime = currentTime;
    if (WiFi.status() != WL_CONNECTED) {
      WiFi.begin(wifiName.c_str(), wifiPass.c_str());
    }
  }
}

void handleSerialFromMicro() {
  static String serialBuffer = "";
  while (Serial.available()) {
    char c = Serial.read();
    serialBuffer += c;
    yield();

    if (c == '\n') {
      serialBuffer.trim();

      if (serialBuffer.startsWith("#") && serialBuffer.endsWith("*")) {
        String input = serialBuffer.substring(1, serialBuffer.length() - 1);

        if (input.startsWith("wifi=")) {
          wifiName = input.substring(5);
          saveSettings();
          Serial.println("WiFi name changed to: " + wifiName);
        } else if (input.startsWith("pass=")) {
          wifiPass = input.substring(5);
          saveSettings();
          Serial.println("WiFi password changed to: " + wifiPass);
        } else if (input.startsWith("port=")) {
          portLastByte = input.substring(5).toInt();
          saveSettings();
          Serial.println("IP updated: http://192.168.1." + String(portLastByte) + "/" + userPath);
        } else if (input.startsWith("user=")) {
          userPath = input.substring(5);
          saveSettings();
          Serial.println("User path updated: http://192.168.1." + String(portLastByte) + "/" + userPath);
        } else if (input == "reset") {
          wifiName = "TPLINK";
          wifiPass = "abcd1234";
          portLastByte = 104;
          userPath = "report";
          saveSettings();
          Serial.println("Settings reset to default.");
        } else if (input.startsWith("GET:")) {
          String key = input.substring(4);
          if (dataStore.containsKey("/" + userPath)) {
            JsonObject obj = dataStore["/" + userPath];
            if (obj.containsKey(key)) {
              String value = obj[key].as<String>();
              Serial.println(key + ":" + value);
            } else {
              Serial.println(key + ":?");
            }
          } else {
            Serial.println(key + ":?");
          }
        } else {
          int sepIndex = input.indexOf(":");
          if (sepIndex > 0) {
            String key = input.substring(0, sepIndex);
            String value = input.substring(sepIndex + 1);

            JsonObject obj;
            if (dataStore["/" + userPath].is<JsonObject>()) {
              obj = dataStore["/" + userPath].as<JsonObject>();
            } else {
              obj = dataStore.createNestedObject("/" + userPath);
            }

            obj[key] = value;
          }
        }
      }

      serialBuffer = "";
    }

    if (serialBuffer.length() > 256) {
      serialBuffer = "";
    }
  }
}


</code></pre>


  <p>Download the program file:</p>
  <a href="esp8266.zip" download>ðŸ“¦ Download esp8266.zip</a>
  <p>Paste the code into Arduino IDE. You can configure Wi-Fi settings before upload:</p>
  <pre><code>
wifiName = "TPLINK";
wifiPass = "abcd1234";
portLastByte = 104;
userPath = "report";
  </code></pre>
  <p>Or send commands via serial after upload:</p>
  <pre><code>
#wifi=TPLINK*
#pass=abcd1234*
#port=104*
#user=report*
  </code></pre>

  <h2>Step 5: Wiring and Upload</h2>
  <img src="wiring1.png" alt="Wiring 1">
  <img src="wiring2.png" alt="Wiring 2">
  <img src="wiring3.png" alt="Wiring 3">
  <img src="wiring4.png" alt="Wiring 4">
  <p>Click <strong>Verify</strong> and then <strong>Upload</strong> in Arduino:</p>
  <img src="upload1.png" alt="Verify and Upload">
  <img src="upload2.png" alt="Upload Complete">


  <h2>Step 6: Serial Monitor</h2>
  <img src="serial1.png" alt="Open Serial Monitor">
 <img src="serial2.png" alt="Open Serial Monitor">
 <img src="wiring5.png" alt="Open Serial Monitor">
  <p>Restart the module. You should see output like:</p>
  <img src="output1.png" alt="Serial Output">

  <h2>Step 7: Microcontroller Connection</h2>
  <img src="micro1.png" alt="Microcontroller Wiring">
  <p>Program your ATmega16 using a compatible programmer:</p>


<pre class="line-numbers"><code class="language-cpp">

$regfile = "m16adef.dat"
$crystal = 11059200

Config Adc = Single , Prescaler = Auto , Reference = Avcc
Config Timer1 = Pwm , Pwm = 10 , Compare_a_pwm = Clear_up , Compare_b_pwm = Clear_up , Prescale = 1
Declare Sub Red

CONFIG PORTB=OUTPUT
   Portb = 0
Config Portc.0 = Input                                      'in key 1
Ddrc.0 = 0 : Portc.0 = 1

 Config Portc.1 = Input                                     'in key 2
Ddrc.1 = 0 : Portc.1 = 1

$baud = 115200

Enable Interrupts

 Config Serialin = Buffered , Size = 41 , Bytematch = 13

Dim Text As String * 40
Dim Text2 As String * 4
Dim Text3 As String * 5
DIM TEMP1,LastTemp1 AS WORD
Dim Temp2,LastTemp2 As Word
Dim Volt,pwm1aa As Word
Dim Volt2,LastVolt2 As Single
Dim Step1 As Byte
dim p,t1,i as byte
dim t2 as bit
dim pc,lastpc,pb,lastpb as byte
config watchdog=2048
start watchdog
 Readeeprom portb , 1
  Waitms 1
  Readeeprom pwm1aa , 3
  Waitms 1
  Open "comd.6:9600,8,n,1" For Output As #1

  Print #1 , "soifgo"
pwm1a=pwm1aa
Main:
waitms 30
  Incr Step1

reset watchdog

    If Step1 >8 Then Step1 = 1


    Select Case Step1

        Case 1

            Volt = Getadc(0)
            Volt2 = Volt / 204.8
               If Volt2 <> Lastvolt2 Then
                   Print "#volt:" ; Fusing(volt2 , "#.##") ; "*"
                   Lastvolt2 = Volt2
               End If
        Case 2
              Temp1 = Getadc(1)
               If Temp1 <> Lasttemp1 Then
                   Print "#temp1" ; ":" ; Temp1 ; "*"
                   Lasttemp1 = Temp1
               End If
        Case 3
            Temp2 = Getadc(2)
               If Temp2 <> Lasttemp2 Then
                   Print "#temp2" ; ":" ; Temp2 ; "*"
                   Lasttemp2 = Temp2
               End If
        Case 4
           Pb = Portb
               If Pb <> Lastpb Then
                  Print "#portb" ; ":" ; Bin(portb) ; "*"
                  Lastpb = Pb
               End If
        Case 5
                 Pc = Portc
               If Pc <> Lastpc Then
                  Print "#pinc" ; ":" ; Pinc.0 ; Pinc.1 ; "*"
                  Lastpc = Pc
               End If

               case 6
               incr p
               if p>7 then p=0
                Print "#GET:port";p;"*"
    End Select




Goto Main

Serial0charmatch:
 waitms 20
Input Text

if text <> "" then call Red
Return


Sub Red
  Reset Watchdog

  Text = Trim(text)
  Text = Ltrim(text)

  'Print #1 , ">";Text;"<"
      If Instr(text , "rang") > 0 Then
      Disable Interrupts
       Print #1 , Mid(text , 6 , 36)
        Enable Interrupts
       End If

   If Instr(text , "pwm1a") > 0 Then
      Text3 = Mid(text , 7 , 4)
      Pwm1a = Val(text3)
      Writeeeprom pwm1a , 3
   End If

  If Instr(text , "port") > 0 Then
     Text2 = Mid(Text , 7 , 1)
     Text = Mid(text , 5 , 1)


      if text2="0" then t2=0
      if text2="1" then t2=1

      t1=val(text)

      If T1 < 8 Then Portb.t1 = T2

   If T1 = 9 Then

          if t2=1 then
            Portb = 255
             For I = 0 To 7
              Print "#port" ; I ; ":1*"
              Waitms 50
             Next
          End If

        if t2=0 then
          portb=0
          for i=0 to 7
           Print  "#port";i ; ":0*"
           waitms 50
          next
        end if


   end if
    Writeeeprom Portb , 1

  End If

   Text = ""
   Text2 = ""
   Text3 = ""
   T1 = 222
   T2 = 0
   Clear Serialin


End Sub



</code></pre>




  <a href="hexfile_esp8266.zip" download>ðŸ“¦ Download HEX File</a>
  <a href="bascom_esp8266.zip" download>ðŸ“¦ Download BASCOM Setup</a>
  <img src="fusebits.png" alt="Fuse Bit Settings">

  <h2>Step 8: Testing in Browser</h2>
  <p>Visit:</p>
  <p>  http://192.168.1.104/report</p>  
  <p>You should see:</p>
  <pre><code>{"volt":"3.16","temp1":"3","temp2":"513","portb":"00000000"}</code></pre>

  <h2>Step 9: SoifGo Integration</h2>
  <img src="soifgo-receive.png" alt="Receive Setup">
  <img src="soifgo-send.png" alt="Send Setup">

<h2>Step 10: ESP8266 Setup Video</h2>
<video controls width="100%">
  <source src="Esp8266 Setup.mp4" type="video/mp4">
  Your browser does not support the video tag.
</video>
  <a href="Esp8266 Setup.mp4" download>ðŸ“¥ Download ESP8266 Setup Video</a>

<h2>Step 11: SoifGo Design â€“ Part 1</h2>
<video controls width="100%">
  <source src="Design_1.mp4" type="video/mp4">
  Your browser does not support the video tag.
</video>
   <a href="Design_1.mp4" download>ðŸ“¥ Download SoifGo Design â€“ Part 1</a>

<h2>Step 12: SoifGo Design â€“ Part 2</h2>
<video controls width="100%">
  <source src="Design_2.mp4" type="video/mp4">
  Your browser does not support the video tag.
</video>
  <a href="Design_2.mp4" download>ðŸ“¥ Download SoifGo Design â€“ Part 2</a>

  <h2>Bonus: RANGMANG Module</h2>

<li><a href="https://soifgo.github.io/soifgo/tutorials/server/rangmang/Rangmang.html"> ðŸŒˆ RANGMANG Module</a></li>

 <h2>Bonus: Proteuse </h2>
 <a href="Proteuse_esp8266.zip" download>ðŸ“¦ Download Proteuse </a>
 <h2>Bonus: Sample soifgo </h2>
 <a href="soifgo_design_esp8266.zip" download>ðŸ“¦ Download soifgo file </a>

    <hr>
<p style="text-align:center;">
  <a href="https://soifgo.github.io/soifgo/tutorials/list.html" 
     style="display:inline-block; padding:10px 20px; background:#0066cc; color:#fff; text-decoration:none; border-radius:5px;">
    â¬… Back to Tutorial
  </a>
</p>



<hr>
<p style="text-align:center;">
  <a href="https://soifgo.github.io/soifgo/index.html" 
     style="display:inline-block; padding:10px 20px; background:#8B4513; color:#fff; text-decoration:none; border-radius:5px;">
    â¬… Back to Home
  </a>
</p>

  
</body>
</html>











